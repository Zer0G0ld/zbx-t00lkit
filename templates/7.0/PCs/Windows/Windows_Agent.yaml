zabbix_export:
  version: '7.0'
  template_groups:
    - uuid: 1b51b0147ea64b04b3f2c0edbc9fc8c0
      name: OS
  templates:
    - uuid: d29b468371734516b44ff67a2718653d
      template: 'Windows Agent'
      name: 'Windows Agent'
      description: 'Modelo para Windows. Requer o agente Zabbix 7.0 ou superior.'
      groups:
        - name: OS
      items:
        - uuid: cbe3ab9ad4244c0aaaaac8b4ee131d62
          name: 'Zabbix agent ping'
          key: agent.ping
          delay: 10s
          description: 'Verifica se o agente Zabbix no host está ativo. Dispara alerta se não responder.'
          tags:
            - tag: component
              value: system
          triggers:
            - uuid: 86f324d1e0c449b0937e7c278ef517f5
              expression: 'last(/Windows Agent/agent.ping)=0'
              name: 'Agente não responde'
              priority: AVERAGE
              description: 'Dispara se o host não responder ao ping do Zabbix Agent. Importante para monitoramento de conectividade.'
              tags:
                - tag: component
                  value: agent
            - uuid: 6785dd8382104468b0a15dfd5c48a063
              expression: 'last(/Windows Agent/agent.ping)=0'
              name: 'Agent ping Teste 1'
              status: DISABLED
              priority: DISASTER
            - uuid: a22011dd4177476ab67f99235720281c
              expression: 'last(/Windows Agent/agent.ping)<>0'
              name: 'Serviço Zabbix Agent está parado'
              priority: HIGH
              description: 'Dispara se o agente Zabbix não está respondendo. Pode indicar host offline ou problema de rede.'
              tags:
                - tag: component
                  value: agent
                - tag: service
                  value: Zabbix
            - uuid: 9d7086599b814d46b534b37fe2f05811
              expression: 'last(/Windows Agent/agent.ping)=1'
              name: 'Teste Alerta'
              status: DISABLED
              priority: DISASTER
              type: MULTIPLE
        - uuid: a6e011cf720941c498fd0e9614cd491f
          name: 'EventLog - Application Error (ID 1000)'
          type: ZABBIX_ACTIVE
          key: 'eventlog[Application,,Error,,1000]'
          delay: 30s
          value_type: LOG
          trends: '0'
          description: 'Detecta falha de aplicativos críticos. Útil para monitorar travamentos de serviços ou software crítico.'
          tags:
            - tag: component
              value: application
            - tag: eventlog
              value: '1000'
          triggers:
            - uuid: 57a9c2c8572449b2b32fe4c70b6b8ca9
              expression: 'last(/Windows Agent/eventlog[Application,,Error,,1000])<>0'
              name: 'Falha de Aplicativo detectada (EventID 1000)'
              priority: WARNING
              description: 'Dispara quando algum aplicativo crítico falha (ID 1000). Ajuda a identificar serviços/parâmetros que precisam de correção.'
              tags:
                - tag: component
                  value: application
                - tag: eventlog
                  value: '1000'
        - uuid: 0a9e3ab5e9d0426a907d1f14e39b0b2a
          name: 'EventLog - Kernel Power (ID 41)'
          type: ZABBIX_ACTIVE
          key: 'eventlog[System,,Critical,,41]'
          delay: 30s
          value_type: LOG
          trends: '0'
          description: 'Detecta reinicializações inesperadas ou quedas de energia, indicando risco de perda de dados.'
          tags:
            - tag: component
              value: 'system,'
            - tag: eventlog
              value: '41'
          triggers:
            - uuid: 4e257a018d084ac2bf59e37ed501c92c
              expression: 'last(/Windows Agent/eventlog[System,,Critical,,41])<>0'
              name: 'Reinicialização inesperada / Queda de energia (EventID 41)'
              priority: HIGH
              description: 'Indica desligamento inesperado ou queda de energia. Importante para rastrear perda de dados ou falhas de hardware.'
              tags:
                - tag: component
                  value: system
                - tag: eventlog
                  value: '41'
        - uuid: a15fc697085b45059777fdf6eb735101
          name: 'EventLog - Bad Block (ID 7)'
          type: ZABBIX_ACTIVE
          key: 'eventlog[System,,Error,,7]'
          delay: 30s
          value_type: LOG
          trends: '0'
          description: 'Indica setores defeituosos em HD/SSD. Ação recomendada: backup e verificação de disco.'
          tags:
            - tag: component
              value: disk
            - tag: eventlog
              value: '7'
          triggers:
            - uuid: e1f4fe09c7a940799df6c75ee7417ec6
              expression: 'last(/Windows Agent/eventlog[System,,Error,,7])<>0'
              name: 'Falha de disco detectada (Bad Block - EventID 7)'
              priority: DISASTER
              description: 'Dispara quando o Windows registra erro de Bad Block. Pode indicar setores defeituosos no HD/SSD. Ação imediata: backup + verificar disco.'
              tags:
                - tag: component
                  value: disk
                - tag: eventlog
                  value: '7'
        - uuid: 13e32c8c676b480bb73bca6eb502095d
          name: 'EventLog - Virtual Memory Error (ID 2020/2021)'
          type: ZABBIX_ACTIVE
          key: 'eventlog[System,,Error,,2020,2021]'
          delay: 30s
          value_type: LOG
          trends: '0'
          description: 'Sistema sem memória virtual ou memória de pool não paginada, podendo travar Windows.'
          tags:
            - tag: component
              value: memory
            - tag: eventlog
              value: 2020/2021
          triggers:
            - uuid: 03665e5616044073a99296dfc0d83775
              expression: 'last(/Windows Agent/eventlog[System,,Error,,2020,2021])<>0'
              name: 'Falta de memória virtual (EventID 2020/2021)'
              priority: DISASTER
              description: 'Dispara quando o sistema está sem memória virtual (2020) ou memória de pool não paginada (2021). Pode travar o Windows.'
              tags:
                - tag: component
                  value: memory
                - tag: eventlog
                  value: 2020/2021
        - uuid: 6d12445462f5406fbf0e988f11e2a145
          name: 'Cache bytes'
          key: 'perf_counter_en["\Memory\Cache Bytes"]'
          units: B
          description: 'Quantidade de memória cache em uso. Pode ajudar a identificar consumo excessivo de memória.'
          tags:
            - tag: component
              value: memory
        - uuid: 1395793f8bc74ccfa5cf3c60cbcba129
          name: 'Memory pool non-paged'
          key: 'perf_counter_en["\Memory\Pool Nonpaged Bytes"]'
          units: B
          description: 'Memória não paginada em uso. Uso elevado pode indicar vazamento de memória de drivers.'
          tags:
            - tag: component
              value: memory
          triggers:
            - uuid: b860dce8600447e5851234655f66bb56
              expression: 'last(/Windows Agent/perf_counter_en["\Memory\Pool Nonpaged Bytes"])>524288000'
              name: 'Memória não paginada alta (>500MB)'
              priority: AVERAGE
              description: 'Dispara quando a memória não paginada ultrapassa 500MB. Pode indicar vazamento de memória de drivers.'
              tags:
                - tag: component
                  value: memory
                - tag: threshold
                  value: 500MB
        - uuid: 294ab721449d4b2b8c3a4f5f80e41cdb
          name: 'Used swap space in %'
          key: 'perf_counter_en["\Paging file(_Total)\% Usage"]'
          value_type: FLOAT
          units: '%'
          description: 'Percentual de uso do arquivo de paginação. Uso alto pode indicar falta de memória RAM.'
          tags:
            - tag: component
              value: memory
            - tag: component
              value: storage
          triggers:
            - uuid: e593bf2c550f468785feb40a4dcf5c62
              expression: 'last(/Windows Agent/perf_counter_en["\Paging file(_Total)\% Usage"])>70'
              name: 'Uso de Swap acima de 70%'
              priority: AVERAGE
              description: 'Dispara quando o arquivo de paginação ultrapassa 70% de uso. Pode indicar falta de memória física.'
              tags:
                - tag: component
                  value: memory
                - tag: threshold
                  value: 70%
        - uuid: c3712c042bdc4431af4d1f0d3287f567
          name: 'CPU DPC time'
          key: 'perf_counter_en["\Processor Information(_total)\% DPC Time"]'
          value_type: FLOAT
          units: '%'
          description: 'Tempo gasto em rotinas DPC (Deferred Procedure Call). Valores altos indicam drivers ou hardware gerando overhead.'
          tags:
            - tag: component
              value: cpu
          triggers:
            - uuid: dcf8c7769be046f8823ef94a4d34dc4d
              expression: 'last(/Windows Agent/perf_counter_en["\Processor Information(_total)\% DPC Time"])>5'
              name: 'CPU DPC Time anormal'
              priority: AVERAGE
              description: 'Tempo gasto em Deferred Procedure Calls (DPC) acima de 5%. Pode indicar que drivers ou hardware estão causando overhead na CPU, afetando performance.'
              tags:
                - tag: component
                  value: cpu
                - tag: metric
                  value: 'DPC Time'
        - uuid: 3a139c6aa75e469b87fbd0ff7e0c5ec0
          name: 'CPU interrupt time'
          key: 'perf_counter_en["\Processor Information(_total)\% Interrupt Time"]'
          value_type: FLOAT
          units: '%'
          description: 'Percentual de tempo gasto com interrupções de hardware. Valores altos indicam possível problema de dispositivo.'
          tags:
            - tag: component
              value: cpu
          triggers:
            - uuid: fb1349434de74fe8a73d95001eb08d90
              expression: 'last(/Windows Agent/perf_counter_en["\Processor Information(_total)\% Interrupt Time"])>5'
              name: 'CPU Interrupt Time alta'
              priority: AVERAGE
              description: 'Percentual de tempo gasto com interrupções de hardware acima de 5%. Pode indicar problemas em dispositivos ou drivers que geram muitas interrupções.'
              tags:
                - tag: component
                  value: cpu
                - tag: metric
                  value: 'Interrupt Time'
        - uuid: d586f35719104e2b9d01cc3f4a43753b
          name: 'CPU privileged time'
          key: 'perf_counter_en["\Processor Information(_total)\% Privileged Time"]'
          value_type: FLOAT
          units: '%'
          description: 'Percentual de tempo da CPU em modo kernel. Valores altos podem indicar processos pesados ou drivers problemáticos.'
          tags:
            - tag: component
              value: cpu
          triggers:
            - uuid: cb43d46f471349e798090c9990856b02
              expression: 'last(/Windows Agent/perf_counter_en["\Processor Information(_total)\% Privileged Time"])>70'
              name: 'CPU Privileged Time alta'
              priority: HIGH
              description: 'Percentual da CPU em modo kernel acima de 70%. Valores altos podem indicar drivers ou processos problemáticos que impactam a performance do sistema.'
              tags:
                - tag: component
                  value: cpu
                - tag: metric
                  value: 'Privileged Time'
            - uuid: fee2a5565d0d44289edff96054dd6fd0
              expression: 'last(/Windows Agent/perf_counter_en["\Processor Information(_total)\% Privileged Time"])>80'
              name: 'CPU User Time alta'
              priority: HIGH
              description: 'Percentual da CPU em modo usuário acima de 80%. Indica processos pesados que estão consumindo muitos recursos do processador.'
              tags:
                - tag: component
                  value: cpu
                - tag: metric
                  value: 'User Time'
        - uuid: 7cd662aba17e48fd961e8dd19637d125
          name: 'CPU user time'
          key: 'perf_counter_en["\Processor Information(_total)\% User Time"]'
          value_type: FLOAT
          units: '%'
          description: 'Percentual de tempo da CPU executando código em modo usuário. Alta utilização indica processos intensivos em CPU.'
          tags:
            - tag: component
              value: cpu
        - uuid: 1d47e283a0c0409cb0dd412016ded78b
          name: 'CPU queue length'
          key: 'perf_counter_en["\System\Processor Queue Length"]'
          value_type: FLOAT
          description: 'Número de threads esperando por CPU. Valores altos por muito tempo indicam gargalo de processamento.'
          tags:
            - tag: component
              value: cpu
          triggers:
            - uuid: fc1cd7a0275b480aaa53e374f8dc633c
              expression: 'avg(/Windows Agent/perf_counter_en["\System\Processor Queue Length"],5m)>5'
              name: 'Alta fila de processador (>5) por 5 minutos'
              priority: AVERAGE
              description: 'Dispara se a fila de CPU estiver acima de 5 por 5 minutos. Indica gargalo de processamento.'
              tags:
                - tag: component
                  value: cpu
                - tag: threshold
                  value: '5'
        - uuid: 42d47118592e4d47936a1697c7115e08
          name: 'Number of processes'
          key: 'proc.num[]'
          description: 'Número total de processos ativos. Pode ser usado para detectar excesso de processos ou loops infinitos.'
          tags:
            - tag: component
              value: os
          triggers:
            - uuid: 326cce9078934db3ae99c9020be6e195
              expression: 'last(/Windows Agent/proc.num[])>=100'
              name: 'Numero de Processos passou de 100'
              priority: AVERAGE
              description: 'Dispara quando a quantidade de processos ativos excede 100. Pode indicar software rodando em excesso.'
              tags:
                - tag: component
                  value: os
                - tag: threshold
                  value: '100'
        - uuid: 66a78252c81d45ca8b4164e409a110db
          name: 'Status do serviço Spooler'
          type: ZABBIX_ACTIVE
          key: 'service.info[Spooler,state]'
          description: 'Indica se o serviço de impressão está rodando. Parado pode impactar impressão e dependências de software.'
          valuemap:
            name: 'Valores do service.info'
          triggers:
            - uuid: 0d070642afa847d0a55e9fb87329cfd4
              expression: 'last(/Windows Agent/service.info[Spooler,state])<>4'
              name: 'Spooler parado'
              priority: HIGH
              description: 'Dispara se o serviço de impressão Spooler não está rodando. Impacta impressões e dependências de software.'
              tags:
                - tag: component
                  value: service
                - tag: service
                  value: Spooler
        - uuid: e9f90a7a24254a0aa209ef1cd6c28894
          name: 'CPU utilization'
          key: system.cpu.util
          value_type: FLOAT
          units: '%'
          description: 'Utilização total da CPU. Alta utilização contínua pode indicar necessidade de investigação de processos.'
          tags:
            - tag: component
              value: cpu
          triggers:
            - uuid: dc75b26fde384468b9be07db0d7560cc
              expression: 'avg(/Windows Agent/system.cpu.util,5m)>90'
              name: 'Alta utilização de CPU (>90%) por 5 minutos'
              priority: HIGH
              description: 'Dispara se a CPU estiver acima de 90% por 5 minutos contínuos. Ajuda a identificar processos pesados ou loop infinito.'
              tags:
                - tag: component
                  value: cpu
                - tag: threshold
                  value: 90%
        - uuid: cd8b9b8f31e44d679dd1c4fb6fcf9dbf
          name: 'System name'
          key: system.hostname
          delay: 1h
          value_type: CHAR
          trends: '0'
          description: 'Nome do host no Windows. Útil para inventário e identificação de host.'
          inventory_link: NAME
          preprocessing:
            - type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 1d
          tags:
            - tag: component
              value: system
        - uuid: 328128d9d2904036b8ab672fb0628590
          name: 'System local time'
          key: system.localtime
          units: unixtime
          description: 'Hora local do sistema. Útil para correlação de logs e eventos.'
          tags:
            - tag: component
              value: system
        - uuid: 186d54fa95884c719acf8b4f6455cab6
          name: 'Operating system architecture'
          key: system.sw.arch
          delay: 1h
          value_type: CHAR
          trends: '0'
          description: 'Arquitetura do sistema (x86/x64).'
          preprocessing:
            - type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 1d
          tags:
            - tag: component
              value: os
        - uuid: 445f305ec49045ddb59c534cffeedddf
          name: 'Operating system'
          key: system.sw.os
          delay: 1h
          value_type: CHAR
          trends: '0'
          description: 'Versão e edição do Windows.'
          inventory_link: OS
          preprocessing:
            - type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 1d
          tags:
            - tag: component
              value: os
        - uuid: e71a5cd9f2244a9fa63f496549c6bcf7
          name: 'Total swap space'
          key: 'system.swap.size[,total]'
          units: B
          description: 'Tamanho total do arquivo de paginação.'
          tags:
            - tag: component
              value: memory
            - tag: component
              value: storage
        - uuid: 0286042c325e4a948db15a9ef240f328
          name: 'System description'
          key: system.uname
          delay: 15m
          value_type: CHAR
          trends: '0'
          description: 'Descrição completa do sistema, incluindo hostname, versão e arquitetura.'
          preprocessing:
            - type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 1d
          tags:
            - tag: component
              value: system
        - uuid: e8e6f4775d0c43f7a8a451797164509c
          name: Uptime
          key: system.uptime
          delay: 10s
          trends: '0'
          units: uptime
          description: 'Tempo que o host está ligado. Pode ser usado para detectar reinicializações recentes.'
          tags:
            - tag: component
              value: system
          triggers:
            - uuid: aa8898f2786a4a9aacc846c0534efe2b
              expression: 'last(/Windows Agent/system.uptime)<300'
              name: 'Ativo a 5min'
              priority: INFO
              description: 'Dispara se o host está ligado há menos de 5 minutos. Ajuda a rastrear boot recente.'
              tags:
                - tag: component
                  value: system
            - uuid: 7f0b9c8366d64400a71df385b6f71544
              expression: 'change(/Windows Agent/system.uptime)>0 and last(/Windows Agent/system.uptime)<600'
              name: 'Sistema reiniciado (uptime menor que 10 min)'
              priority: INFO
              description: 'Dispara quando o host foi reiniciado recentemente (menos de 10 minutos). Útil para validar reinicializações.'
              tags:
                - tag: component
                  value: system
                - tag: event
                  value: restart
        - uuid: 0f90b20a4af94d7989234d306dc824ac
          name: 'Total memory'
          key: 'vm.memory.size[total]'
          units: B
          description: 'Quantidade total de RAM instalada no host.'
          tags:
            - tag: component
              value: memory
        - uuid: e11b02d40a23490e86a83d63d217bc9a
          name: 'Used memory'
          key: 'vm.memory.size[used]'
          units: B
          description: 'Quantidade de memória RAM atualmente em uso.'
          tags:
            - tag: component
              value: memory
        - uuid: 982afc523c7c47e98dec50fe7f46e675
          name: 'Memory utilization'
          type: CALCULATED
          key: vm.memory.util
          value_type: FLOAT
          units: '%'
          params: 'last(//vm.memory.size[used]) / last(//vm.memory.size[total]) * 100'
          description: 'Percentual de memória RAM utilizada.'
          tags:
            - tag: component
              value: memory
          triggers:
            - uuid: b4bc23e973944905aeeb546a081596c3
              expression: 'last(/Windows Agent/vm.memory.util)>90'
              name: 'Utilização de memória >90%'
              priority: HIGH
              description: 'Dispara quando o consumo de memória ultrapassa 90%. Pode causar lentidão ou travamentos.'
              tags:
                - tag: component
                  value: memory
                - tag: threshold
                  value: 90%
        - uuid: 89b263ee0288488eba4ef537b659b627
          name: 'Number of cores'
          key: 'wmi.get[root/cimv2,"Select NumberOfLogicalProcessors from Win32_ComputerSystem"]'
          description: 'Número de núcleos lógicos da CPU.'
          tags:
            - tag: component
              value: cpu
      discovery_rules:
        - uuid: 41ebad0928d94192ac2c5df60480cb2a
          name: 'Descoberta automática de interfaces de rede'
          key: net.if.discovery
          delay: 1h
          status: DISABLED
          filter:
            evaltype: AND
            conditions:
              - macro: '{#IFDESCR}'
                value: '.*'
                formulaid: A
              - macro: '{#IFGUID}'
                value: '.*'
                formulaid: B
              - macro: '{#IFNAME}'
                value: '.*'
                formulaid: C
              - macro: '{#SPEED}'
                value: '.*'
                formulaid: D
          description: |
            Descobre automaticamente todas as interfaces físicas de rede ativas nos hosts monitorados via agente Zabbix (ativo) e cria dinamicamente os protótipos de itens e triggers correspondentes, garantindo monitoramento consistente de tráfego, status e pacotes por interface.
            
            Todos os protótipos utilizam macros LLD:
            
            {#IFNAME} → nome do adaptador
            
            {#IFDESCR} → descrição da interface
            
            {#SPEED} → velocidade nominal da interface
            
            Alterações nos thresholds dos protótipos de triggers devem ser avaliadas considerando a capacidade real da rede para evitar falsos positivos.
            
            Novos adaptadores de rede adicionados aos hosts serão automaticamente monitorados sem necessidade de intervenção manual.
            
            Recomenda-se não duplicar itens do template original fora da descoberta, para evitar conflitos.
          item_prototypes:
            - uuid: e799b37974f548b28fa2687ffc3383fa
              name: 'Pacotes de entrada'
              type: ZABBIX_ACTIVE
              key: 'net.if.in[pkts,{#IFNAME}]'
              units: pacotes/s
              trigger_prototypes:
                - uuid: 2453aa58ba9b4174971ef71c9155d791
                  expression: 'change(/Windows Agent/net.if.in[pkts,{#IFNAME}])<0'
                  name: 'Pacotes de entrada muito baixos em {#IFNAME}'
                  priority: AVERAGE
                  description: |
                    Detecta queda súbita na recepção de pacotes na interface.
                    
                    - Pacotes de entrada com queda brusca (entrada < esperado)
                - uuid: 02d40f9b598d472a9a472c62a72c94d0
                  expression: 'rate(/Windows Agent/net.if.in[pkts,{#IFNAME}],5m)>100000'
                  name: 'Tráfego de entrada alto em {#IFNAME}'
                  priority: HIGH
                  description: |
                    Detecta aumento anormal no tráfego de entrada.
                    
                    - Pacotes recebidos muito altos (possível flood ou tráfego anormal)
            - uuid: 08b9abed246a46bda07cddd50833bfe2
              name: 'Tráfego de entrada'
              type: ZABBIX_ACTIVE
              key: 'net.if.in[{#IFNAME}]'
              units: bps
              trigger_prototypes:
                - uuid: 0f61eba0c12047edadc2f86359f1256e
                  expression: 'avg(/Windows Agent/net.if.in[{#IFNAME}],5m)<1000'
                  name: 'Tráfego de entrada abaixo do mínimo em {#IFNAME}'
                  priority: AVERAGE
                  description: 'Detecta baixa utilização (útil para interfaces críticas)'
                - uuid: bc4f7e6df51f4c4681040f3e1edc8c63
                  expression: 'avg(/Windows Agent/net.if.in[{#IFNAME}],5m)>100000000'
                  name: 'Tráfego de entrada alto em {#IFNAME}'
                  priority: HIGH
                  description: 'Alerta se a entrada > 100 Mbps'
            - uuid: aa550ca5415246e993a4887d52f90cae
              name: 'Pacotes de saída'
              type: ZABBIX_ACTIVE
              key: 'net.if.out[pkts,{#IFNAME}]'
              units: pacotes/s
              trigger_prototypes:
                - uuid: 629035deb688481e8a7c91fc478813c3
                  expression: 'change(/Windows Agent/net.if.out[pkts,{#IFNAME}])<0'
                  name: 'Pacotes de saída muito baixos em {#IFNAME}'
                  priority: AVERAGE
                  description: |
                    Detecta queda súbita na transmissão de pacotes na interface.
                    
                    - Pacotes de saída com queda brusca (saída < esperado)
                - uuid: 781c39445d0f492b996758726a65b5e4
                  expression: 'rate(/Windows Agent/net.if.out[pkts,{#IFNAME}],5m)>100000'
                  name: 'Tráfego de saída alto em {#IFNAME}'
                  priority: HIGH
                  description: |
                    Detecta aumento anormal no tráfego de saída.
                    
                    - Pacotes enviados muito altos (possível flood ou tráfego anormal)
            - uuid: cdbb092b5b42469b827365f0ac52529b
              name: 'Tráfego de saída'
              type: ZABBIX_ACTIVE
              key: 'net.if.out[{#IFNAME}]'
              units: bps
              trigger_prototypes:
                - uuid: af793efcaba34c9a88edc95a126f1b2b
                  expression: 'avg(/Windows Agent/net.if.out[{#IFNAME}],5m)<1000'
                  name: 'Tráfego de saída abaixo do mínimo em {#IFNAME}'
                  priority: AVERAGE
                  description: 'Detecta baixa utilização'
                - uuid: 2af986ec34bf45d09f63926754f94ad1
                  expression: 'avg(/Windows Agent/net.if.out[{#IFNAME}],5m)>100000000'
                  name: 'Tráfego de saída alto em {#IFNAME}'
                  priority: HIGH
                  description: 'Alerta se a saída > 100 Mbps'
            - uuid: cdd08887e12843a98dfd82dd94603975
              name: 'Status da interface'
              type: ZABBIX_ACTIVE
              key: 'net.if.status[{#IFNAME}]'
              units: 0/1
              trigger_prototypes:
                - uuid: 2b0f4ca9d4204b64a440b35e6d26de57
                  expression: 'last(/Windows Agent/net.if.status[{#IFNAME}])=2'
                  name: 'Interface {#IFNAME} inativa'
                  priority: AVERAGE
                  description: 'Detecta interfaces desconectadas'
          lld_macro_paths:
            - lld_macro: '{#IFDESCR}'
              path: '$[*].{#IFDESCR}'
            - lld_macro: '{#IFGUID}'
              path: '$[*].{#IFGUID}'
            - lld_macro: '{#IFNAME}'
              path: '$[*].{#IFNAME}'
            - lld_macro: '{#SPEED}'
              path: '$[*].{#SPEED}'
        - uuid: 6ff4a2547a854d8fac15ce962b6c5ec2
          name: 'Descoberta de serviços Windows'
          type: ZABBIX_ACTIVE
          key: service.discovery
          delay: 1h
          filter:
            evaltype: AND
            conditions:
              - macro: '{#SERVICE.DISPLAYNAME}'
                value: '(?i)(Telemetry|Update|Installer|Hotfix|Driver|Adobe|Google|OneDrive|Teams)'
                operator: NOT_MATCHES_REGEX
                formulaid: A
              - macro: '{#SERVICE.NAME}'
                value: '^(WinDefend|wuauserv|Spooler|BITS|EventLog|MSSQL.*|W3SVC|Backup.*|AV.*|SQLAgent.*)$'
                formulaid: B
              - macro: '{#SERVICE.STARTMODE}'
                value: (Auto|Manual)
                formulaid: C
          description: |
            monitorar serviços que importam, tipo:
            
            Serviços de sistema críticos: WinDefend, wuauserv (Windows Update), Spooler (impressão), BITS (Background Intelligent Transfer), EventLog.
            
            Serviços de aplicação: bancos de dados (MSSQL*), IIS (W3SVC), serviços de backup, antivírus corporativo, etc.
            
            Serviços que impactam a disponibilidade ou segurança.
            
            Evitar:
            
            Serviços temporários de instalação, telemetry, atualização de apps de terceiros que mudam sempre de nome.
            
            Serviços não essenciais que geram alerta a todo momento.
          item_prototypes:
            - uuid: 7fe8f432c889409490fcf65f640d4ed4
              name: 'Serviço iniciado {#SERVICE.DISPLAYNAME}'
              type: ZABBIX_ACTIVE
              key: 'service.info[{#SERVICE.NAME},startmode]'
              description: |
                Indica o modo de inicialização configurado do serviço {#SERVICE.DISPLAYNAME}.
                
                Valores possíveis:
                
                Automático (2)
                
                Manual (3)
                
                Desativado (4)
                
                Objetivo: Garantir que serviços críticos estão configurados para iniciar automaticamente ou manualmente conforme esperado, evitando falhas de disponibilidade após reinicializações.
                
                Observações: Serviços que deveriam ser sempre automáticos, mas estão em manual, podem gerar alertas de atenção.
              valuemap:
                name: 'Modo de inicialização (service.info[{#SERVICE.NAME},startmod)'
              tags:
                - tag: component
                  value: service
              trigger_prototypes:
                - uuid: 09d153770cb04e7e991c4a2cde233aef
                  expression: 'last(/Windows Agent/service.info[{#SERVICE.NAME},startmode])<>2'
                  name: 'Serviço {#SERVICE.DISPLAYNAME} não inicia automaticamente'
                  priority: AVERAGE
                  description: 'Dispara se o serviço não estiver configurado como Automático (2 = Auto).'
            - uuid: dd7a62fb38c847a483971f1c24713b85
              name: 'Status do serviço {#SERVICE.DISPLAYNAME}'
              type: ZABBIX_ACTIVE
              key: 'service.info[{#SERVICE.NAME},state]'
              description: |
                Monitora o estado atual do serviço {#SERVICE.DISPLAYNAME} no host Windows.
                
                Valores possíveis:
                
                Parando (1)
                
                Parado (2)
                
                Iniciando (3)
                
                Iniciado (4)
                
                Objetivo: Detectar se o serviço está parado ou falhando, permitindo alertas imediatos de indisponibilidade de serviços críticos de sistema ou aplicação.
                
                Observações: Ideal para serviços como WinDefend, wuauserv, Spooler, EventLog, bancos de dados ou servidores IIS.
              valuemap:
                name: 'Status do serviço (service.info[{#SERVICE.NAME},state])'
              tags:
                - tag: component
                  value: service
              trigger_prototypes:
                - uuid: a5ee4e8e21eb4aa89040696b8519f066
                  expression: 'last(/Windows Agent/service.info[{#SERVICE.NAME},state])<>4'
                  name: 'Serviço {#SERVICE.DISPLAYNAME} parado'
                  priority: HIGH
                  description: 'Dispara se o serviço não estiver em execução (4 = Running).'
        - uuid: 339422e2f8c74e95b4c9452381aab927
          name: 'Descoberta de sistemas de arquivos'
          type: ZABBIX_ACTIVE
          key: vfs.fs.dependent.discovery
          status: DISABLED
          filter:
            conditions:
              - macro: '{#FSTYPE}'
                value: CD-ROM
                formulaid: A
              - macro: '{#FSTYPE}'
                value: Rede
                formulaid: B
          description: 'Descobre automaticamente todos os sistemas de arquivos montados nos hosts monitorados via agente Zabbix (ativo) e cria protótipos de itens e triggers correspondentes, garantindo monitoramento consistente de espaço e uso de inodes.'
          item_prototypes:
            - uuid: b07456f6ce754d0eb8254d0514c842b5
              name: 'Inodes livres em {#FSNAME}'
              type: ZABBIX_ACTIVE
              key: 'vfs.fs.inodes[{#FSNAME},free]'
              units: inodes
            - uuid: f7e2a676cfc5483d9097447b19a80769
              name: 'Uso percentual de inodes em {#FSNAME}'
              type: ZABBIX_ACTIVE
              key: 'vfs.fs.inodes[{#FSNAME},pused]'
              units: '%'
              trigger_prototypes:
                - uuid: 4c9baa42c82649bdb67a042b89b3f8b9
                  expression: 'avg(/Windows Agent/vfs.fs.inodes[{#FSNAME},pused],5m)>95'
                  name: 'Inodes quase cheios em {#FSNAME}'
                  priority: HIGH
                  description: 'Crítico para inodes'
                - uuid: e4f63cfb0b694e2ca7563a83590dc358
                  expression: 'avg(/Windows Agent/vfs.fs.inodes[{#FSNAME},pused],5m)>85'
                  name: 'Inodes usados alto em {#FSNAME}'
                  priority: AVERAGE
                  description: 'Se o FS tiver inodes limitados'
            - uuid: df9e997f164b46a8ae697e1b3e1a055e
              name: 'Inodes usados em {#FSNAME}'
              type: ZABBIX_ACTIVE
              key: 'vfs.fs.inodes[{#FSNAME},used]'
              units: inodes
              description: 'Opcional, se o FS suporta inodes'
            - uuid: 4cebf40446c0402ea92ad093fdd4eb8d
              name: 'Espaço livre em {#FSNAME}'
              type: ZABBIX_ACTIVE
              key: 'vfs.fs.size[{#FSNAME},free]'
              units: bytes
              description: 'Espaço disponível'
            - uuid: f757c02f1f264b7ca7a70980982efa59
              name: 'Uso percentual de {#FSNAME}'
              type: ZABBIX_ACTIVE
              key: 'vfs.fs.size[{#FSNAME},pused]'
              value_type: FLOAT
              units: '%'
              description: 'Percentual usado'
              trigger_prototypes:
                - uuid: b109718af1c144f3bfac395dd8faecf1
                  expression: 'avg(/Windows Agent/vfs.fs.size[{#FSNAME},pused],5m)>95'
                  name: 'Espaço quase cheio em {#FSNAME}'
                  priority: HIGH
                  description: 'Alerta crítico quando uso ultrapassa 95%'
                - uuid: c76380302a9e40268fda5dc7a89fb09e
                  expression: 'avg(/Windows Agent/vfs.fs.size[{#FSNAME},pused],5m)>85'
                  name: 'Espaço usado alto em {#FSNAME}'
                  priority: AVERAGE
                  description: 'Alerta quando uso ultrapassa 85%'
            - uuid: ed0d8636785b458f8edc060058407858
              name: 'Espaço total em {#FSNAME}'
              type: ZABBIX_ACTIVE
              key: 'vfs.fs.size[{#FSNAME},total]'
              units: bytes
              description: 'Tamanho total do FSystem'
            - uuid: b329846118354b3385ea02dfff7f7de6
              name: 'Espaço usado em {#FSNAME}'
              type: ZABBIX_ACTIVE
              key: 'vfs.fs.size[{#FSNAME},used]'
              units: bytes
              description: 'Espaço em uso'
          lld_macro_paths:
            - lld_macro: '{#FSLABEL}'
              path: $.label
            - lld_macro: '{#FSNAME}'
              path: $.name
            - lld_macro: '{#FSTYPE}'
              path: $.type
          preprocessing:
            - type: JAVASCRIPT
              parameters:
                - |
                  // Recebe o JSON bruto do agente
                  // Exemplo do que o vfs.fs.dependent.discovery retorna:
                  // [
                  //   {"fsname":"/","fstype":"ext4","bytes":{"total":500000000,"used":300000000,"free":200000000,"pused":60}},
                  //   {"fsname":"/home","fstype":"ext4","bytes":{"total":1000000000,"used":400000000,"free":600000000,"pused":40}}
                  // ]
                  
                  var discovered = []; // array final que será retornado para o LLD
                  
                  // Percorre cada filesystem retornado pelo agente
                  for (var i = 0; i < value.length; i++) {
                      var fs = value[i];
                  
                      // Ignorar sistemas que não queremos monitorar (opcional)
                      if (fs.fstype === "tmpfs" || fs.fstype === "devtmpfs") {
                          continue;
                      }
                  
                      // Monta o objeto que o Zabbix espera
                      discovered.push({
                          "{#FSNAME}": fs.fsname,
                          "{#FSTYPE}": fs.fstype,
                          "{#FSLABEL}": fs.fsname.replace(/\//g, "_") // para criar labels válidos
                      });
                  }
                  
                  // Retorna o array final para o Zabbix
                  return JSON.stringify(discovered);
      tags:
        - tag: class
          value: os
        - tag: target
          value: windows
      dashboards:
        - uuid: 3f85a75afb6849849c7db9bae9c6b03c
          name: 'Novo dashboard'
          pages:
            - name: 'Geral Windows'
              display_period: '30'
              widgets:
                - type: actionlog
                  width: '27'
                  height: '5'
                  fields:
                    - type: ACTION
                      name: actionids.0
                      value:
                        name: 'Report problems to Zabbix administrators'
                    - type: INTEGER
                      name: rf_rate
                      value: '30'
                    - type: INTEGER
                      name: statuses.0
                      value: '0'
                    - type: INTEGER
                      name: statuses.1
                      value: '1'
                    - type: INTEGER
                      name: statuses.2
                      value: '2'
                    - type: USER
                      name: userids.0
                      value:
                        username: Admin
                - type: hostnavigator
                  x: '27'
                  width: '17'
                  height: '5'
                  fields:
                    - type: INTEGER
                      name: group_by.0.attribute
                      value: '0'
                    - type: INTEGER
                      name: group_by.1.attribute
                      value: '2'
                    - type: INTEGER
                      name: maintenance
                      value: '1'
                    - type: INTEGER
                      name: problems
                      value: '0'
                    - type: STRING
                      name: reference
                      value: LFFLC
                    - type: INTEGER
                      name: severities.0
                      value: '0'
                    - type: INTEGER
                      name: severities.1
                      value: '1'
                    - type: INTEGER
                      name: severities.2
                      value: '2'
                    - type: INTEGER
                      name: severities.3
                      value: '3'
                    - type: INTEGER
                      name: severities.4
                      value: '4'
                    - type: INTEGER
                      name: severities.5
                      value: '5'
                - type: problems
                  x: '44'
                  width: '28'
                  height: '5'
                  fields:
                    - type: STRING
                      name: reference
                      value: FIYIS
                    - type: INTEGER
                      name: severities.0
                      value: '0'
                    - type: INTEGER
                      name: severities.1
                      value: '1'
                    - type: INTEGER
                      name: severities.2
                      value: '2'
                    - type: INTEGER
                      name: severities.3
                      value: '3'
                    - type: INTEGER
                      name: severities.4
                      value: '4'
                    - type: INTEGER
                      name: severities.5
                      value: '5'
                    - type: INTEGER
                      name: show_opdata
                      value: '2'
                    - type: INTEGER
                      name: show_suppressed
                      value: '1'
                    - type: INTEGER
                      name: show_symptoms
                      value: '1'
      valuemaps:
        - uuid: 5974a6dbccff4ced85a0228cb7a48683
          name: 'Modo de inicialização (service.info[{#SERVICE.NAME},startmod)'
          mappings:
            - value: '2'
              newvalue: Automático
            - value: '3'
              newvalue: Manual
            - value: '4'
              newvalue: Desativado
        - uuid: cb7113de7f524fb7b87b4dba1a505b19
          name: 'Status do serviço (service.info[{#SERVICE.NAME},state])'
          mappings:
            - value: '1'
              newvalue: Parando
            - value: '2'
              newvalue: Parado
            - value: '3'
              newvalue: Iniciando
            - value: '4'
              newvalue: Iniciado
        - uuid: 2382bde9dfae45c8a2914a71d8cdc0fc
          name: 'Valores do service.info'
          mappings:
            - value: '0'
              newvalue: Unknown
            - value: '1'
              newvalue: Stopped
            - value: '2'
              newvalue: Starting
            - value: '3'
              newvalue: Stopping
            - value: '4'
              newvalue: Running
            - value: '5'
              newvalue: 'Continue Pending'
            - value: '6'
              newvalue: 'Pause Pending'
            - value: '7'
              newvalue: Paused
  graphs:
    - uuid: 0d152aa0b39141b6a55fb7fcead10e58
      name: cpu
      graph_items:
        - color: 199C0D
          calc_fnc: ALL
          item:
            host: 'Windows Agent'
            key: system.cpu.util
    - uuid: fcc31bc01ddc47e3b09c59bc8c170a9a
      name: 'Numero de Processos'
      graph_items:
        - drawtype: GRADIENT_LINE
          color: 0040FF
          calc_fnc: ALL
          item:
            host: 'Windows Agent'
            key: 'proc.num[]'
    - uuid: 76bb0c6092c148eaa027fd404c9398e3
      name: 'Uso da CPU e da Memoria'
      graph_items:
        - drawtype: GRADIENT_LINE
          color: 199C0D
          calc_fnc: ALL
          item:
            host: 'Windows Agent'
            key: system.cpu.util
        - sortorder: '1'
          drawtype: GRADIENT_LINE
          color: F63100
          calc_fnc: ALL
          item:
            host: 'Windows Agent'
            key: vm.memory.util
