zabbix_export:
  version: '7.0'
  template_groups:
    - uuid: 1b51b0147ea64b04b3f2c0edbc9fc8c0
      name: OS
  templates:
    - uuid: bbb4bada786d46b7b9faf99f5175ad3b
      template: 'MacOS Agent'
      name: 'MacOS Agent'
      description: |
        Modelo para macOS. Requer o agente Zabbix 7.0 ou mais recente.
        
        Observações sobre a descoberta do sistema de arquivos (FS):
        - O FS ext4/3/2 reserva espaço para uso privilegiado, normalmente definido em 5% por padrão.
        - O BTRFS aloca um padrão de 10% do volume para suas próprias necessidades.
        - Para mitigar potenciais desastres, os gatilhos de uso do FS são baseados no espaço máximo disponível.
        - Fórmula de utilização: 'pused = 100 - 100 * (disponível / total - livre + disponível)'
        - O gráfico de utilização do FS, derivado de protótipos gráficos, reflete o espaço reservado do FS como a diferença entre o espaço usado e o disponível do volume total.
      groups:
        - name: OS
      items:
        - uuid: 033865e83d614f83a2de0d4c3496d32e
          name: 'Nome do host do agente Zabbix em execução'
          key: agent.hostname
          delay: 1h
          value_type: CHAR
          trends: '0'
          preprocessing:
            - type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 1d
          tags:
            - tag: component
              value: system
        - uuid: 18f7a9cf19784a549f1db3fd7c78d238
          name: 'Zabbix agent ping'
          key: agent.ping
          description: 'O agente sempre retorna "1" para este item. Pode ser usado em conjunto com nodata() para verificação de disponibilidade.'
          valuemap:
            name: 'Status do ping do agente Zabbix'
          tags:
            - tag: component
              value: system
        - uuid: 2e406e7543a749d39bcc5432195c1f78
          name: 'Versão do agente Zabbix em execução'
          key: agent.version
          delay: 1h
          value_type: CHAR
          trends: '0'
          preprocessing:
            - type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 1d
          tags:
            - tag: component
              value: application
        - uuid: c417c7f4d53541fe9a6eb3132eab9c27
          name: 'Número máximo de arquivos abertos'
          key: kernel.maxfiles
          delay: 1h
          description: 'Pode ser aumentado usando o utilitário `sysctl` ou modificando o arquivo `/etc/sysctl.conf`.'
          tags:
            - tag: component
              value: os
          triggers:
            - uuid: d58a5096fc374939b98d518b69cb7c2b
              expression: 'last(/MacOS Agent/kernel.maxfiles)<1024'
              name: 'macOS: O número máximo configurado de arquivos abertos é muito baixo'
              priority: INFO
              tags:
                - tag: scope
                  value: desempenho
                - tag: scope
                  value: notícia
        - uuid: fdcb7b3a0b0a460fbf1ff6c49e9184fc
          name: 'Número máximo de processos'
          key: kernel.maxproc
          delay: 1h
          description: 'Pode ser aumentado usando o utilitário `sysctl` ou modificando o arquivo `/etc/sysctl.conf`.'
          tags:
            - tag: component
              value: os
          triggers:
            - uuid: 640802954a9c43ccb5b44727bdbbb7a7
              expression: 'last(/MacOS Agent/kernel.maxproc)<256'
              name: 'macOS: O número máximo de processos configurado é muito baixo'
              priority: INFO
              tags:
                - tag: scope
                  value: desempenho
                - tag: scope
                  value: notice
        - uuid: dc92b03912634f41ac635cdd46ae11f3
          name: 'Tráfego de rede de entrada em en0'
          key: 'net.if.in[en0]'
          units: bps
          preprocessing:
            - type: CHANGE_PER_SECOND
              parameters:
                - ''
            - type: MULTIPLIER
              parameters:
                - '8'
          tags:
            - tag: component
              value: network
        - uuid: 5cce406e11de494a9a5f03271387a6a7
          name: 'Tráfego de rede de saída em en0'
          key: 'net.if.out[en0]'
          units: bps
          preprocessing:
            - type: CHANGE_PER_SECOND
              parameters:
                - ''
            - type: MULTIPLIER
              parameters:
                - '8'
          tags:
            - tag: component
              value: network
        - uuid: c1c17ae81ced493fa9fe357a7ded1189
          name: 'Tempo de inicialização do host'
          key: system.boottime
          delay: 10m
          units: unixtime
          tags:
            - tag: component
              value: os
        - uuid: 8a2cb720605f4422ab031302235840aa
          name: 'Carga do processador (média de 1 minuto por núcleo)'
          key: 'system.cpu.load[percpu,avg1]'
          value_type: FLOAT
          description: 'Calculado como a carga da CPU do sistema dividida pelo número de núcleos da CPU.'
          tags:
            - tag: component
              value: cpu
          triggers:
            - uuid: b119e64035e34917873740f6e96df395
              expression: 'avg(/MacOS Agent/system.cpu.load[percpu,avg1],5m)>5'
              name: 'macOS: a carga do processador está muito alta'
              priority: WARNING
              tags:
                - tag: scope
                  value: desempenho
                - tag: scope
                  value: disponibilidade
        - uuid: bfe72fb32de347a68cadc655d6f102f3
          name: 'Carga do processador (média de 5 minutos por núcleo)'
          key: 'system.cpu.load[percpu,avg5]'
          value_type: FLOAT
          description: 'Calculado como a carga da CPU do sistema dividida pelo número de núcleos da CPU.'
          tags:
            - tag: component
              value: cpu
        - uuid: 5135829dc0694815b9e2b486e444d662
          name: 'Carga do processador (média de 15 minutos por núcleo)'
          key: 'system.cpu.load[percpu,avg15]'
          value_type: FLOAT
          description: 'Calculado como a carga da CPU do sistema dividida pelo número de núcleos da CPU.'
          tags:
            - tag: component
              value: cpu
        - uuid: 111d52e946ca4f0396f05a3565cb844a
          name: 'Nome do host'
          key: system.hostname
          delay: 1h
          value_type: CHAR
          trends: '0'
          description: 'O nome do host do sistema.'
          inventory_link: NAME
          preprocessing:
            - type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 1d
          tags:
            - tag: component
              value: os
          triggers:
            - uuid: c2a1514e19b64470bcd143b5c3fcea11
              expression: 'last(/MacOS Agent/system.hostname,#1)<>last(/MacOS Agent/system.hostname,#2)'
              name: 'macOS: o nome do host foi alterado'
              priority: INFO
              tags:
                - tag: scope
                  value: notícia
        - uuid: d8a0976c1a31402fbec4a8186a5305e0
          name: 'Horário local do anfitrião'
          key: system.localtime
          units: unixtime
          description: 'A hora local do sistema do host.'
          tags:
            - tag: component
              value: os
        - uuid: 85a3fa3a69754471871cd8a1c43cee52
          name: 'Informações do sistema'
          key: system.uname
          delay: 1h
          value_type: CHAR
          trends: '0'
          description: 'Informações normalmente retornadas por `uname -a`.'
          inventory_link: OS
          preprocessing:
            - type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 1d
          tags:
            - tag: component
              value: os
          triggers:
            - uuid: f60906af02d74724be9a6e688a0a8706
              expression: 'last(/MacOS Agent/system.uname,#1)<>last(/MacOS Agent/system.uname,#2)'
              name: 'macOS: as informações do host foram alteradas'
              priority: INFO
              tags:
                - tag: scope
                  value: notícia
        - uuid: 5e0b9d90c2504058a278789b50c8219b
          name: 'Tempo de atividade do sistema'
          key: system.uptime
          delay: 10m
          units: uptime
          description: 'O tempo de atividade do sistema é expresso no seguinte formato: "N dias, hh:mm:ss".'
          tags:
            - tag: component
              value: os
          triggers:
            - uuid: 8be1b412320646ce9a7c4b6644ef85bd
              expression: 'change(/MacOS Agent/system.uptime)<0'
              name: 'macOS: O servidor acabou de ser reiniciado'
              priority: INFO
              tags:
                - tag: scope
                  value: notícia
        - uuid: cb9fac2299894d66a7b531cd933c3265
          name: 'Número de usuários logados'
          key: system.users.num
          description: 'O número de usuários que estão conectados no momento.'
          tags:
            - tag: component
              value: os
            - tag: component
              value: security
        - uuid: 774c3622a6f247fb9a78d72c51cd0b17
          name: 'Soma de verificação de /etc/passwd'
          key: 'vfs.file.cksum[/etc/passwd,sha256]'
          delay: 15m
          value_type: CHAR
          trends: '0'
          preprocessing:
            - type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 1h
          tags:
            - tag: component
              value: security
          triggers:
            - uuid: e95ab453b4bb4b3e8de3e0fa0c51e685
              expression: 'last(/MacOS Agent/vfs.file.cksum[/etc/passwd,sha256],#1)<>last(/MacOS Agent/vfs.file.cksum[/etc/passwd,sha256],#2)'
              name: 'macOS: /etc/passwd foi alterado'
              priority: WARNING
              tags:
                - tag: scope
                  value: segurança
        - uuid: 87d39b71c383488ba0ba69fc37757c50
          name: 'Obter sistemas de arquivos'
          key: vfs.fs.get
          history: '0'
          value_type: TEXT
          trends: '0'
          description: 'A chave `vfs.fs.get` obtém um conjunto de informações brutas sobre os sistemas de arquivos, que serão posteriormente extraídas por pré-processamento em itens dependentes.'
          tags:
            - tag: component
              value: raw
        - uuid: 2e9cfbca15ba4508a42d9aa1c94a4c84
          name: 'Memória disponível'
          key: 'vm.memory.size[available]'
          units: B
          description: 'Definido como livre + em cache + buffers.'
          tags:
            - tag: component
              value: memory
          triggers:
            - uuid: 63c9ecb6dc944dca9ec424043b2cc49e
              expression: 'last(/MacOS Agent/vm.memory.size[available])<20M'
              name: 'macOS: Falta de memória disponível no servidor'
              priority: AVERAGE
              tags:
                - tag: scope
                  value: capacidade
                - tag: scope
                  value: desempenho
        - uuid: 90b296e796324e85ba1575e9be5756f8
          name: 'Memória total'
          key: 'vm.memory.size[total]'
          delay: 1h
          units: B
          description: 'Total memory expressed in bytes.'
          tags:
            - tag: component
              value: memory
        - uuid: 6b14bf614b2247dabbf9a7bf35a9e9ca
          name: 'Disponibilidade do Agente Zabbix'
          type: INTERNAL
          key: 'zabbix[host,agent,available]'
          description: 'Usado para monitorar o status de disponibilidade do agente'
          valuemap:
            name: zabbix.host.disponível
          tags:
            - tag: component
              value: system
          triggers:
            - uuid: 77e70c1d9e094f699cd961acd9fcff77
              expression: 'max(/MacOS Agent/zabbix[host,agent,available],{$AGENT.TIMEOUT})=0'
              name: 'macOS: o agente Zabbix não está disponível'
              event_name: 'macOS: o agente Zabbix não está disponível (para {$AGENT.TIMEOUT})'
              priority: AVERAGE
              description: 'Somente para verificações passivas; a disponibilidade do(s) agente(s) e de um host é usada com `{$AGENT.TIMEOUT}` como limite de tempo.'
              manual_close: 'YES'
              tags:
                - tag: scope
                  value: disponibilidade
      discovery_rules:
        - uuid: 55b82d8d5cff4b25a56a807b0c49592b
          name: 'Descoberta do sistema de arquivos montado'
          type: DEPENDENT
          key: vfs.fs.dependent.discovery
          delay: '0'
          filter:
            evaltype: AND
            conditions:
              - macro: '{#FSNAME}'
                value: '{$VFS.FS.FSNAME.MATCHES}'
                formulaid: A
              - macro: '{#FSNAME}'
                value: '{$VFS.FS.FSNAME.NOT_MATCHES}'
                operator: NOT_MATCHES_REGEX
                formulaid: B
              - macro: '{#FSTYPE}'
                value: '{$VFS.FS.FSTYPE.MATCHES}'
                formulaid: C
              - macro: '{#FSTYPE}'
                value: '{$VFS.FS.FSTYPE.NOT_MATCHES}'
                operator: NOT_MATCHES_REGEX
                formulaid: D
          description: 'Descoberta de sistemas de arquivos montados com diferentes tipos. Observe que a opção de excluir imagens de software dmg da descoberta está disponível apenas com agentes Zabbix 6.4 e superiores.'
          item_prototypes:
            - uuid: 218acd99420f45e0b387fc3b1cda4620
              name: 'FS [{#FSNAME}]: Inodes: Livre, em %'
              type: DEPENDENT
              key: 'vfs.fs.dependent.inode[{#FSNAME},pfree]'
              delay: '0'
              value_type: FLOAT
              units: '%'
              description: 'Espaço livre de metadados expresso em %.'
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - $.inodes.pfree
              master_item:
                key: 'vfs.fs.dependent[{#FSNAME},data]'
              tags:
                - tag: component
                  value: armazenar
                - tag: filesystem
                  value: '{#FSNAME}'
                - tag: fstype
                  value: '{#FSTYPE}'
              trigger_prototypes:
                - uuid: 18287a389ed845808a988abf8c242f82
                  expression: 'min(/MacOS Agent/vfs.fs.dependent.inode[{#FSNAME},pfree],5m)<{$VFS.FS.INODE.PFREE.MIN.CRIT:"{#FSNAME}"}'
                  name: 'macOS: FS [{#FSNAME}]: Ficando sem inodes livres'
                  event_name: 'macOS: {#FSNAME}: Ficando sem inodes livres (grátis < {$VFS.FS.INODE.PFREE.MIN.CRIT:"{#FSNAME}"}%)'
                  opdata: 'Inodes livres: {ITEM.LOADVALUE1}'
                  priority: AVERAGE
                  description: 'A gravação em disco pode falhar se os nós de índice estiverem esgotados, levando a mensagens de erro como "Não há espaço restante no dispositivo" ou "Disco cheio", apesar do espaço livre disponível.'
                  tags:
                    - tag: scope
                      value: capacidade
                    - tag: scope
                      value: desempenho
                - uuid: 586a21c1e57245d6b75b137e76482b74
                  expression: 'min(/MacOS Agent/vfs.fs.dependent.inode[{#FSNAME},pfree],5m)<{$VFS.FS.INODE.PFREE.MIN.WARN:"{#FSNAME}"}'
                  name: 'macOS: FS [{#FSNAME}]: Ficando sem inodes livres'
                  event_name: 'macOS: FS [{#FSNAME}]: Ficando sem inodes livres (grátis < {$VFS.FS.INODE.PFREE.MIN.WARN:"{#FSNAME}"}%)'
                  opdata: 'Inodes livres: {ITEM.LOADVALUE1}'
                  priority: WARNING
                  description: 'A gravação em disco pode falhar se os nós de índice estiverem esgotados, levando a mensagens de erro como "Não há espaço restante no dispositivo" ou "Disco cheio", apesar do espaço livre disponível.'
                  dependencies:
                    - name: 'macOS: FS [{#FSNAME}]: Ficando sem inodes livres'
                      expression: 'min(/MacOS Agent/vfs.fs.dependent.inode[{#FSNAME},pfree],5m)<{$VFS.FS.INODE.PFREE.MIN.CRIT:"{#FSNAME}"}'
                  tags:
                    - tag: scope
                      value: capacidade
                    - tag: scope
                      value: desempenho
            - uuid: b84912e919554f9080e7a7fb33dbd634
              name: 'FS [{#FSNAME}]: Espaço: Disponível'
              type: DEPENDENT
              key: 'vfs.fs.dependent.size[{#FSNAME},free]'
              delay: '0'
              units: B
              description: 'Espaço de armazenamento disponível expresso em bytes.'
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - $.bytes.free
              master_item:
                key: 'vfs.fs.dependent[{#FSNAME},data]'
              tags:
                - tag: component
                  value: armazenar
                - tag: filesystem
                  value: '{#FSNAME}'
                - tag: fstype
                  value: '{#FSTYPE}'
            - uuid: f52b6ce5c1224785a9d32c70238b6e50
              name: 'FS [{#FSNAME}]: Espaço: Disponível, em %'
              type: DEPENDENT
              key: 'vfs.fs.dependent.size[{#FSNAME},pfree]'
              delay: '0'
              value_type: FLOAT
              units: '%'
              description: |
                Métrica obsoleta.
                Disponibilidade de espaço expressa em porcentagem, calculada com base nos espaços disponíveis atuais e máximos.
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - $.bytes.pfree
              master_item:
                key: 'vfs.fs.dependent[{#FSNAME},data]'
              tags:
                - tag: component
                  value: armazenar
                - tag: deprecated
                - tag: filesystem
                  value: '{#FSNAME}'
                - tag: fstype
                  value: '{#FSTYPE}'
            - uuid: 86c8208bb42642ae8eee578c6359ac52
              name: 'FS [{#FSNAME}]: Espaço: Usado, em %'
              type: DEPENDENT
              key: 'vfs.fs.dependent.size[{#FSNAME},pused]'
              delay: '0'
              value_type: FLOAT
              units: '%'
              description: 'Calculado como a porcentagem do espaço atualmente utilizado em comparação ao espaço máximo disponível.'
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - $.bytes.pused
              master_item:
                key: 'vfs.fs.dependent[{#FSNAME},data]'
              tags:
                - tag: component
                  value: armazenar
                - tag: filesystem
                  value: '{#FSNAME}'
                - tag: fstype
                  value: '{#FSTYPE}'
              trigger_prototypes:
                - uuid: 049634ffce004d3ca89a4d56639bc3a5
                  expression: 'min(/MacOS Agent/vfs.fs.dependent.size[{#FSNAME},pused],5m)>{$VFS.FS.PUSED.MAX.WARN:"{#FSNAME}"}'
                  name: 'macOS: FS [{#FSNAME}]: Espaço insuficiente'
                  event_name: 'macOS: FS [{#FSNAME}]: Espaço insuficiente (usado > {$VFS.FS.PUSED.MAX.WARN:"{#FSNAME}"}%, total {{?last(//vfs.fs.dependent.size[{#FSNAME},total])/1024/1024/1024}.fmtnum(1)}GB)'
                  opdata: 'Espaço utilizado: {{ITEM.LASTVALUE1}.fmtnum(1)}%'
                  priority: WARNING
                  description: |
                    O uso de espaço do volume excede o limite `{$VFS.FS.PUSED.MAX.WARN:"{#FSNAME}"}%`.
                    A expressão de gatilho é baseada no espaço usado atualmente e no máximo de espaços disponíveis.
                    O nome do evento representa o espaço total do volume, que pode ser diferente do espaço máximo disponível, dependendo do tipo de sistema de arquivos.
                  manual_close: 'YES'
                  dependencies:
                    - name: 'macOS: FS [{#FSNAME}]: O espaço está criticamente baixo'
                      expression: 'min(/MacOS Agent/vfs.fs.dependent.size[{#FSNAME},pused],5m)>{$VFS.FS.PUSED.MAX.CRIT:"{#FSNAME}"}'
                  tags:
                    - tag: scope
                      value: capacidade
                    - tag: scope
                      value: disponibilidade
                - uuid: ed03cc2d570e44038c4c8784462814d3
                  expression: 'min(/MacOS Agent/vfs.fs.dependent.size[{#FSNAME},pused],5m)>{$VFS.FS.PUSED.MAX.CRIT:"{#FSNAME}"}'
                  name: 'macOS: FS [{#FSNAME}]: O espaço está criticamente baixo'
                  event_name: 'macOS: FS [{#FSNAME}]: O espaço está criticamente baixo (usado > {$VFS.FS.PUSED.MAX.CRIT:"{#FSNAME}"}%, total {{?last(//vfs.fs.dependent.size[{#FSNAME},total])/1024/1024/1024}.fmtnum(1)}GB)'
                  opdata: 'Espaço utilizado: {{ITEM.LASTVALUE1}.fmtnum(1)}%'
                  priority: AVERAGE
                  description: |
                    O uso de espaço do volume excede o limite `{$VFS.FS.PUSED.MAX.CRIT:"{#FSNAME}"}%`.
                    A expressão de gatilho é baseada no espaço usado atualmente e no máximo de espaços disponíveis.
                    O nome do evento representa o espaço total do volume, que pode ser diferente do espaço máximo disponível, dependendo do tipo de sistema de arquivos.
                  manual_close: 'YES'
                  tags:
                    - tag: scope
                      value: capacidade
                    - tag: scope
                      value: disponibilidade
            - uuid: 16951db9f22d4d67b12068ddbe2098d2
              name: 'FS [{#FSNAME}]: Espaço: Total'
              type: DEPENDENT
              key: 'vfs.fs.dependent.size[{#FSNAME},total]'
              delay: '0'
              units: B
              description: 'Espaço total expresso em bytes.'
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - $.bytes.total
              master_item:
                key: 'vfs.fs.dependent[{#FSNAME},data]'
              tags:
                - tag: component
                  value: armazenar
                - tag: filesystem
                  value: '{#FSNAME}'
                - tag: fstype
                  value: '{#FSTYPE}'
            - uuid: 80a8f62f9e7e487e95ebb10f793e25a1
              name: 'FS [{#FSNAME}]: Espaço: Usado'
              type: DEPENDENT
              key: 'vfs.fs.dependent.size[{#FSNAME},used]'
              delay: '0'
              units: B
              description: 'Armazenamento usado expresso em bytes.'
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - $.bytes.used
              master_item:
                key: 'vfs.fs.dependent[{#FSNAME},data]'
              tags:
                - tag: component
                  value: armazenar
                - tag: filesystem
                  value: '{#FSNAME}'
                - tag: fstype
                  value: '{#FSTYPE}'
            - uuid: 8139cf4545e746839151f0cabf72baf7
              name: 'FS [{#FSNAME}]: Obter dados'
              type: DEPENDENT
              key: 'vfs.fs.dependent[{#FSNAME},data]'
              delay: '0'
              history: 1h
              value_type: TEXT
              trends: '0'
              description: 'Dados intermediários do sistema de arquivos `{#FSNAME}`.'
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - '$.[?(@.fsname==''{#FSNAME}'')].first()'
              master_item:
                key: vfs.fs.get
              tags:
                - tag: component
                  value: armazenar
                - tag: component
                  value: cru
                - tag: filesystem
                  value: '{#FSNAME}'
                - tag: fstype
                  value: '{#FSTYPE}'
          graph_prototypes:
            - uuid: 29c76802253a4364959c1f7a3eaabe25
              name: 'FS [{#FSTYPE}({#FSNAME})]: Gráfico de uso de espaço, em % (relativo ao máximo disponível)'
              width: '600'
              height: '340'
              ymin_type_1: FIXED
              ymax_type_1: FIXED
              graph_items:
                - drawtype: FILLED_REGION
                  color: F63100
                  calc_fnc: ALL
                  item:
                    host: 'MacOS Agent'
                    key: 'vfs.fs.dependent.size[{#FSNAME},pused]'
            - uuid: 3ccb4e74790d4c1eb69d75579c59b586
              name: 'FS [{#FSTYPE}({#FSNAME})]: Gráfico de utilização do espaço (em relação ao total)'
              width: '600'
              height: '340'
              yaxismax: '0'
              show_work_period: 'NO'
              show_triggers: 'NO'
              type: PIE
              show_3d: 'YES'
              graph_items:
                - color: '787878'
                  calc_fnc: LAST
                  type: GRAPH_SUM
                  item:
                    host: 'MacOS Agent'
                    key: 'vfs.fs.dependent.size[{#FSNAME},total]'
                - sortorder: '1'
                  color: F63100
                  calc_fnc: LAST
                  item:
                    host: 'MacOS Agent'
                    key: 'vfs.fs.dependent.size[{#FSNAME},used]'
                - sortorder: '2'
                  color: 199C09
                  calc_fnc: LAST
                  item:
                    host: 'MacOS Agent'
                    key: 'vfs.fs.dependent.size[{#FSNAME},free]'
          master_item:
            key: vfs.fs.get
          lld_macro_paths:
            - lld_macro: '{#FSNAME}'
              path: $.fsname
            - lld_macro: '{#FSOPTIONS}'
              path: $.fsoptions
            - lld_macro: '{#FSTYPE}'
              path: $.fstype
          preprocessing:
            - type: JAVASCRIPT
              parameters:
                - |
                  var filesystems = JSON.parse(value);
                  
                  result = filesystems.map(function (filesystem) {
                  	return {
                  		'fsname': filesystem.fsname,
                  		'fstype': filesystem.fstype,
                  		'fsoptions': filesystem.fsoptions
                  	};
                  });
                  
                  return JSON.stringify(result);
            - type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 1h
          overrides:
            - name: 'Excluir dano'
              step: '1'
              filter:
                evaltype: AND
                conditions:
                  - macro: '{#FSOPTIONS}'
                    value: '(?:^|,)noowners\b'
                    formulaid: A
                  - macro: '{#FSOPTIONS}'
                    value: '(?:^|,)read-only\b'
                    formulaid: B
                  - macro: '{#FSOPTIONS}'
                    operator: EXISTS
                    formulaid: C
                  - macro: '{#FSTYPE}'
                    value: hfs
                    formulaid: D
              operations:
                - operationobject: ITEM_PROTOTYPE
                  operator: REGEXP
                  value: .+
                  discover: NO_DISCOVER
            - name: 'Pular coleta de metadados para FS dinâmico'
              step: '2'
              filter:
                conditions:
                  - macro: '{#FSTYPE}'
                    value: ^(btrfs|zfs)$
                    formulaid: A
              operations:
                - operationobject: ITEM_PROTOTYPE
                  operator: LIKE
                  value: Inodes
                  discover: NO_DISCOVER
      tags:
        - tag: class
          value: os
        - tag: target
          value: macos
      macros:
        - macro: '{$AGENT.TIMEOUT}'
          value: 3m
          description: 'Tempo limite após o qual o agente é considerado indisponível. Funciona apenas para agentes acessíveis pelo servidor/proxy Zabbix (em modo passivo).'
        - macro: '{$VFS.FS.FSNAME.MATCHES}'
          value: .+
          description: 'Usado para descoberta de sistemas de arquivos. Pode ser substituído no nível do host ou do modelo vinculado.'
        - macro: '{$VFS.FS.FSNAME.NOT_MATCHES}'
          value: ^(/dev|/sys|/run|/proc|.+/shm$)
          description: 'Usado para descoberta de sistemas de arquivos. Pode ser substituído no nível do host ou do modelo vinculado.'
        - macro: '{$VFS.FS.FSTYPE.MATCHES}'
          value: ^(btrfs|ext2|ext3|ext4|reiser|xfs|ffs|ufs|jfs|jfs2|vxfs|hfs|apfs|refs|ntfs|fat32|zfs)$
          description: 'Usado para descoberta de sistemas de arquivos. Pode ser substituído no nível do host ou do modelo vinculado.'
        - macro: '{$VFS.FS.FSTYPE.NOT_MATCHES}'
          value: ^\s$
          description: 'Usado para descoberta de sistemas de arquivos. Pode ser substituído no nível do host ou do modelo vinculado.'
        - macro: '{$VFS.FS.INODE.PFREE.MIN.CRIT}'
          value: '10'
          description: 'O limite crítico da utilização de metadados do sistema de arquivos.'
        - macro: '{$VFS.FS.INODE.PFREE.MIN.WARN}'
          value: '20'
          description: 'O limite de aviso da utilização de metadados do sistema de arquivos.'
        - macro: '{$VFS.FS.PUSED.MAX.CRIT}'
          value: '90'
          description: 'O limite crítico de utilização do sistema de arquivos.'
        - macro: '{$VFS.FS.PUSED.MAX.WARN}'
          value: '80'
          description: 'O limite de aviso da utilização do sistema de arquivos.'
      dashboards:
        - uuid: c004f2d530bf4a2caa452aa16d7f1c52
          name: 'Desempenho do sistema'
          pages:
            - widgets:
                - type: graph
                  name: 'CPU load'
                  width: '72'
                  height: '5'
                  fields:
                    - type: GRAPH
                      name: graphid.0
                      value:
                        host: 'MacOS Agent'
                        name: 'macOS: carga da CPU'
                    - type: STRING
                      name: reference
                      value: AAAAA
                - type: graph
                  name: 'Memory usage'
                  'y': '5'
                  width: '72'
                  height: '5'
                  fields:
                    - type: GRAPH
                      name: graphid.0
                      value:
                        host: 'MacOS Agent'
                        name: 'macOS: Uso de memória'
                    - type: STRING
                      name: reference
                      value: AAAAB
                - type: graphprototype
                  'y': '10'
                  width: '72'
                  height: '5'
                  fields:
                    - type: INTEGER
                      name: columns
                      value: '3'
                    - type: GRAPH_PROTOTYPE
                      name: graphid.0
                      value:
                        host: 'MacOS Agent'
                        name: 'FS [{#FSTYPE}({#FSNAME})]: Gráfico de utilização do espaço (em relação ao total)'
                    - type: STRING
                      name: reference
                      value: AAAEA
        - uuid: c9e7ad58d5c64f14b321464ae954101c
          name: 'Sistemas de arquivos'
          pages:
            - name: Overview
              widgets:
                - type: graphprototype
                  width: '72'
                  height: '5'
                  fields:
                    - type: INTEGER
                      name: columns
                      value: '3'
                    - type: GRAPH_PROTOTYPE
                      name: graphid.0
                      value:
                        host: 'MacOS Agent'
                        name: 'FS [{#FSTYPE}({#FSNAME})]: Gráfico de utilização do espaço (em relação ao total)'
                    - type: STRING
                      name: reference
                      value: AAAEB
                - type: graphprototype
                  'y': '5'
                  width: '72'
                  height: '5'
                  fields:
                    - type: INTEGER
                      name: columns
                      value: '1'
                    - type: GRAPH_PROTOTYPE
                      name: graphid.0
                      value:
                        host: 'MacOS Agent'
                        name: 'FS [{#FSTYPE}({#FSNAME})]: Gráfico de uso de espaço, em % (relativo ao máximo disponível)'
                    - type: STRING
                      name: reference
                      value: AAAEC
      valuemaps:
        - uuid: 940e61830d654a089e19f80ef623e32f
          name: 'Status do ping do agente Zabbix'
          mappings:
            - value: '1'
              newvalue: Up
        - uuid: bbe2a1baf40f4042859b5f4e66211489
          name: zabbix.host.disponível
          mappings:
            - value: '0'
              newvalue: 'não disponível'
            - value: '1'
              newvalue: disponível
            - value: '2'
              newvalue: desconhecido
  graphs:
    - uuid: 09cbe6bf07a94002901e60c5f2d0ee6a
      name: 'macOS: carga da CPU'
      ymin_type_1: FIXED
      graph_items:
        - color: '009900'
          item:
            host: 'MacOS Agent'
            key: 'system.cpu.load[percpu,avg1]'
        - sortorder: '1'
          color: '000099'
          item:
            host: 'MacOS Agent'
            key: 'system.cpu.load[percpu,avg5]'
        - sortorder: '2'
          color: '990000'
          item:
            host: 'MacOS Agent'
            key: 'system.cpu.load[percpu,avg15]'
    - uuid: 9e1ed6bfadcd407c86da8d7e999aa865
      name: 'macOS: Tráfego de rede em en0'
      ymin_type_1: FIXED
      graph_items:
        - drawtype: GRADIENT_LINE
          color: 00AA00
          item:
            host: 'MacOS Agent'
            key: 'net.if.in[en0]'
        - sortorder: '1'
          drawtype: GRADIENT_LINE
          color: 3333FF
          item:
            host: 'MacOS Agent'
            key: 'net.if.out[en0]'
    - uuid: 3bd057de65984212b35b19b31a4c8f24
      name: 'macOS: Uso de memória'
      ymin_type_1: FIXED
      ymax_type_1: ITEM
      ymax_item_1:
        host: 'MacOS Agent'
        key: 'vm.memory.size[total]'
      graph_items:
        - drawtype: GRADIENT_LINE
          color: 00C800
          item:
            host: 'MacOS Agent'
            key: 'vm.memory.size[available]'
